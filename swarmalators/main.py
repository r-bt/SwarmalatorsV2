import numpy as np
import os
from swarmalator_loop import Swarmalator
from experiments import run_experiments
import random
from laser import LaserTracker
from waypoints import SAM_waypoints_smooth

## NOTE: MODIFY TO THE PORTs ON YOUR COMPUTER FOR THE NRF5340
is_windows = os.name == "nt"
PORT1 = "/dev/tty.usbmodem0010500530493" if not is_windows else "COM7"
PORT2 = "/dev/tty.usbmodem0010500746993" if not is_windows else "COM9"

SPHEROS_OLD = [
    "SB-1B35",
    "SB-F860",
    "SB-2175",
    "SB-369C",
    "SB-618E",
    "SB-6B58",
    "SB-9938",
    "SB-BFD4",
    "SB-C1D2",
    "SB-CEFA",
    "SB-DF1D",
    "SB-F465",
    "SB-F479",
    "SB-F885",
    "SB-FCB2",
]

SPHEROS_NEW = [
    # "SB-31B8",
    "SB-9CA8",
    # "SB-80C4",
    "SB-F509",
    # "SB-5883",
    "SB-8893",
    "SB-D64E",
    "SB-7D72",
    "SB-7D7C",
    "SB-4483",
    "SB-378F",
    # "SB-2C58",
    "SB-D9E2",
    # "SB-2E4B",
    "SB-6320",
]

CAMERA_ID = 1


def main():
    """
    Performs the swarmalator model on the Spheros
    """

    spheros = len(SPHEROS_NEW)

    # Setup the swarmalator model
    natural_frequencies = np.zeros(spheros)
    # half = spheros // 2
    # natural_frequencies[:half] = 1
    # natural_frequencies[half:] = -1
    # phase = np.linspace(0, 2 * np.pi, spheros, endpoint=False)
    phase = np.ones(spheros)

    # random.shuffle(phase)

    # targets = [[1, 1], [1, -1], [-1, -1], [-1, 1]]

    # LaserTracker.init_tracker()

    # laser_tracker = LaserTracker()

    # laser_tracker.track()

    # laser_tracker.close()

    # path = laser_tracker.get_path()

    # print(path)

    # path = [
    #     (-1.625, -1.2625),
    #     (-1.5791666666666666, -1.2833333333333332),
    #     (-1.5791666666666666, -1.2958333333333334),
    #     (-1.5875, -1.2916666666666667),
    #     (-1.5916666666666666, -1.2958333333333334),
    #     (-1.5916666666666666, -1.2958333333333334),
    #     (-1.5958333333333332, -1.2916666666666667),
    #     (-1.6041666666666667, -1.2791666666666666),
    #     (-1.6041666666666667, -1.2625),
    #     (-1.6083333333333334, -1.2416666666666667),
    #     (-1.6041666666666667, -1.2125),
    #     (-1.6, -1.1708333333333334),
    #     (-1.5958333333333332, -1.1125),
    #     (-1.5958333333333332, -1.1125),
    #     (-1.6041666666666667, -1.0416666666666667),
    #     (-1.6041666666666667, -0.9541666666666666),
    #     (-1.6, -0.8624999999999999),
    #     (-1.6125, -0.75),
    #     (-1.6125, -0.625),
    #     (-1.6125, -0.625),
    #     (-1.6041666666666667, -0.4708333333333333),
    #     (-1.6125, -0.325),
    #     (-1.625, -0.2),
    #     (-1.6333333333333333, -0.05),
    #     (-1.65, 0.1125),
    #     (-1.65, 0.1125),
    #     (-1.6624999999999999, 0.24166666666666667),
    #     (-1.6666666666666667, 0.35),
    #     (-1.6708333333333334, 0.4666666666666667),
    #     (-1.6708333333333334, 0.55),
    #     (-1.6708333333333334, 0.6083333333333333),
    #     (-1.675, 0.6583333333333333),
    #     (-1.675, 0.6583333333333333),
    #     (-1.6666666666666667, 0.6958333333333333),
    #     (-1.65, 0.7291666666666666),
    #     (-1.6458333333333333, 0.7375),
    #     (-1.6375, 0.7375),
    #     (-1.6291666666666667, 0.75),
    #     (-1.6291666666666667, 0.75),
    #     (-1.6208333333333333, 0.7458333333333333),
    #     (-1.6166666666666667, 0.725),
    #     (-1.6125, 0.7041666666666666),
    #     (-1.6041666666666667, 0.6791666666666667),
    #     (-1.5875, 0.6333333333333333),
    #     (-1.5666666666666667, 0.575),
    #     (-1.5666666666666667, 0.575),
    #     (-1.5416666666666667, 0.5041666666666667),
    #     (-1.5083333333333333, 0.425),
    #     (-1.4625, 0.35),
    #     (-1.4166666666666667, 0.2625),
    #     (-1.3625, 0.15),
    #     (-1.3625, 0.15),
    #     (-1.3208333333333333, 0.09166666666666666),
    #     (-1.2625, -0.0),
    #     (-1.2208333333333332, -0.07083333333333333),
    #     (-1.1875, -0.14166666666666666),
    #     (-1.1625, -0.19166666666666665),
    #     (-1.1416666666666666, -0.225),
    #     (-1.1416666666666666, -0.225),
    #     (-1.1291666666666667, -0.25416666666666665),
    #     (-1.1083333333333334, -0.275),
    #     (-1.0875, -0.275),
    #     (-1.075, -0.2708333333333333),
    #     (-1.0583333333333333, -0.25),
    #     (-1.0416666666666667, -0.2125),
    #     (-1.0416666666666667, -0.2125),
    #     (-1.0166666666666666, -0.17083333333333334),
    #     (-0.9916666666666667, -0.12083333333333333),
    #     (-0.9583333333333334, -0.05416666666666667),
    #     (-0.9166666666666666, 0.03333333333333333),
    #     (-0.8666666666666667, 0.12916666666666665),
    #     (-0.8666666666666667, 0.12916666666666665),
    #     (-0.8333333333333334, 0.21666666666666667),
    #     (-0.775, 0.35),
    #     (-0.7333333333333333, 0.4375),
    #     (-0.7125, 0.49166666666666664),
    #     (-0.6666666666666666, 0.6),
    #     (-0.6375, 0.6875),
    #     (-0.6375, 0.6875),
    #     (-0.6083333333333333, 0.7541666666666667),
    #     (-0.5916666666666667, 0.7875),
    #     (-0.5666666666666667, 0.825),
    #     (-0.5541666666666667, 0.8291666666666666),
    #     (-0.5416666666666666, 0.8166666666666667),
    #     (-0.5416666666666666, 0.8166666666666667),
    #     (-0.5291666666666667, 0.7875),
    #     (-0.5083333333333333, 0.7375),
    #     (-0.4875, 0.65),
    #     (-0.4875, 0.5541666666666667),
    #     (-0.4791666666666667, 0.45416666666666666),
    #     (-0.4666666666666667, 0.35833333333333334),
    #     (-0.4666666666666667, 0.35833333333333334),
    #     (-0.46249999999999997, 0.25),
    #     (-0.4583333333333333, 0.12916666666666665),
    #     (-0.45416666666666666, -0.0125),
    #     (-0.45, -0.12916666666666665),
    #     (-0.45, -0.2375),
    #     (-0.45, -0.2375),
    #     (-0.4583333333333333, -0.35),
    #     (-0.4666666666666667, -0.45),
    #     (-0.475, -0.5333333333333333),
    #     (-0.48333333333333334, -0.6083333333333333),
    #     (-0.49583333333333335, -0.6958333333333333),
    #     (-0.5041666666666667, -0.7833333333333333),
    #     (-0.5041666666666667, -0.7833333333333333),
    #     (-0.5041666666666667, -0.8416666666666667),
    #     (-0.5041666666666667, -0.9041666666666667),
    #     (-0.5041666666666667, -0.9708333333333333),
    #     (-0.5041666666666667, -1.0166666666666666),
    #     (-0.49583333333333335, -1.05),
    #     (-0.49583333333333335, -1.05),
    #     (-0.49166666666666664, -1.0833333333333333),
    #     (-0.48333333333333334, -1.1041666666666667),
    #     (-0.4791666666666667, -1.1083333333333334),
    #     (-0.475, -1.1083333333333334),
    #     (-0.475, -1.1),
    #     (-0.4583333333333333, -1.0916666666666666),
    #     (-0.44166666666666665, -1.0833333333333333),
    #     (-0.44166666666666665, -1.0833333333333333),
    #     (-0.425, -1.075),
    #     (-0.4, -1.075),
    #     (-0.375, -1.0708333333333333),
    #     (-0.3375, -1.0625),
    #     (-0.2916666666666667, -1.0625),
    #     (-0.24583333333333332, -1.0666666666666667),
    #     (-0.24583333333333332, -1.0666666666666667),
    #     (-0.20416666666666666, -1.0583333333333333),
    #     (-0.15833333333333333, -1.0416666666666667),
    #     (-0.09583333333333333, -1.0291666666666666),
    #     (-0.041666666666666664, -1.025),
    #     (0.016666666666666666, -1.0125),
    #     (0.075, -0.9833333333333333),
    #     (0.075, -0.9833333333333333),
    #     (0.12916666666666665, -0.975),
    #     (0.175, -0.975),
    #     (0.225, -0.9666666666666667),
    #     (0.26666666666666666, -0.9541666666666666),
    #     (0.3, -0.9583333333333334),
    #     (0.3, -0.9583333333333334),
    #     (0.32916666666666666, -0.9541666666666666),
    #     (0.35, -0.9458333333333333),
    #     (0.37083333333333335, -0.9458333333333333),
    #     (0.37916666666666665, -0.9416666666666667),
    #     (0.3875, -0.9333333333333333),
    #     (0.39166666666666666, -0.9291666666666667),
    #     (0.39166666666666666, -0.9291666666666667),
    #     (0.3875, -0.9291666666666667),
    #     (0.3833333333333333, -0.9166666666666666),
    #     (0.3833333333333333, -0.8833333333333333),
    #     (0.37916666666666665, -0.8291666666666666),
    #     (0.37083333333333335, -0.7583333333333333),
    #     (0.36666666666666664, -0.6666666666666666),
    #     (0.36666666666666664, -0.6666666666666666),
    #     (0.36666666666666664, -0.55),
    #     (0.375, -0.43333333333333335),
    #     (0.37083333333333335, -0.31666666666666665),
    #     (0.375, -0.1875),
    #     (0.375, -0.04583333333333333),
    #     (0.375, 0.09166666666666666),
    #     (0.375, 0.09166666666666666),
    #     (0.375, 0.22916666666666666),
    #     (0.36666666666666664, 0.375),
    #     (0.3625, 0.48333333333333334),
    #     (0.35, 0.5791666666666666),
    #     (0.3458333333333333, 0.6416666666666666),
    #     (0.3375, 0.6791666666666667),
    #     (0.3375, 0.6791666666666667),
    #     (0.3333333333333333, 0.6833333333333333),
    #     (0.325, 0.65),
    #     (0.325, 0.5875),
    #     (0.325, 0.5),
    #     (0.325, 0.4125),
    #     (0.3416666666666667, 0.2875),
    #     (0.3416666666666667, 0.2875),
    #     (0.3458333333333333, 0.15416666666666667),
    #     (0.32916666666666666, 0.025),
    #     (0.3208333333333333, -0.1125),
    #     (0.3333333333333333, -0.24583333333333332),
    #     (0.32916666666666666, -0.37083333333333335),
    #     (0.3208333333333333, -0.5),
    #     (0.32916666666666666, -0.5958333333333333),
    #     (0.32916666666666666, -0.5958333333333333),
    #     (0.3541666666666667, -0.6833333333333333),
    #     (0.35833333333333334, -0.775),
    #     (0.3541666666666667, -0.85),
    #     (0.3625, -0.8958333333333334),
    #     (0.36666666666666664, -0.9291666666666667),
    #     (0.36666666666666664, -0.9291666666666667),
    #     (0.37083333333333335, -0.95),
    #     (0.37083333333333335, -0.9541666666666666),
    #     (0.37916666666666665, -0.95),
    #     (0.3833333333333333, -0.9458333333333333),
    #     (0.3875, -0.9416666666666667),
    #     (0.3958333333333333, -0.9249999999999999),
    #     (0.4125, -0.9125),
    #     (0.4125, -0.9125),
    #     (0.42916666666666664, -0.9083333333333333),
    #     (0.45416666666666666, -0.9041666666666667),
    #     (0.49166666666666664, -0.9),
    #     (0.5291666666666667, -0.9),
    #     (0.5291666666666667, -0.9),
    #     (0.5791666666666666, -0.8958333333333334),
    #     (0.6333333333333333, -0.8958333333333334),
    #     (0.6875, -0.8916666666666666),
    #     (0.75, -0.8875),
    #     (0.8125, -0.8875),
    #     (0.8791666666666667, -0.8958333333333334),
    #     (0.8791666666666667, -0.8958333333333334),
    #     (0.9416666666666667, -0.8958333333333334),
    #     (1.0041666666666667, -0.8958333333333334),
    #     (1.0666666666666667, -0.8875),
    #     (1.125, -0.8833333333333333),
    #     (1.1791666666666667, -0.875),
    #     (1.225, -0.8708333333333333),
    #     (1.2708333333333333, -0.8666666666666667),
    #     (1.2708333333333333, -0.8666666666666667),
    #     (1.3041666666666667, -0.8624999999999999),
    #     (1.3291666666666666, -0.8624999999999999),
    #     (1.35, -0.8624999999999999),
    #     (1.3666666666666667, -0.8666666666666667),
    #     (1.375, -0.8666666666666667),
    #     (1.375, -0.8666666666666667),
    #     (1.3833333333333333, -0.8458333333333333),
    #     (1.375, -0.825),
    #     (1.375, -0.7875),
    #     (1.375, -0.7875),
    #     (1.3666666666666667, -0.7208333333333333),
    #     (1.3583333333333334, -0.6333333333333333),
    #     (1.3583333333333334, -0.5416666666666666),
    #     (1.3583333333333334, -0.44166666666666665),
    #     (1.3625, -0.325),
    #     (1.3625, -0.24583333333333332),
    #     (1.3625, -0.24583333333333332),
    #     (1.3708333333333333, -0.12916666666666665),
    #     (1.3833333333333333, -0.0125),
    #     (1.3875, 0.075),
    #     (1.3916666666666666, 0.19166666666666665),
    #     (1.4041666666666666, 0.29583333333333334),
    #     (1.3958333333333333, 0.37916666666666665),
    #     (1.3958333333333333, 0.45),
    #     (1.3958333333333333, 0.45),
    #     (1.4083333333333332, 0.5375),
    #     (1.4083333333333332, 0.5875),
    #     (1.4, 0.6291666666666667),
    #     (1.4041666666666666, 0.6666666666666666),
    #     (1.4083333333333332, 0.7041666666666666),
    #     (1.4083333333333332, 0.7041666666666666),
    #     (1.4, 0.7041666666666666),
    #     (1.3875, 0.7041666666666666),
    #     (1.3666666666666667, 0.7125),
    #     (1.3333333333333333, 0.7125),
    #     (1.2833333333333332, 0.7083333333333334),
    #     (1.225, 0.725),
    #     (1.225, 0.725),
    #     (1.1458333333333333, 0.7458333333333333),
    #     (1.0541666666666667, 0.7666666666666666),
    #     (0.9625, 0.7833333333333333),
    #     (0.8624999999999999, 0.8083333333333333),
    #     (0.7833333333333333, 0.825),
    #     (0.6916666666666667, 0.8375),
    #     (0.6916666666666667, 0.8375),
    #     (0.6125, 0.8375),
    #     (0.5416666666666666, 0.8416666666666667),
    #     (0.49166666666666664, 0.8458333333333333),
    #     (0.45416666666666666, 0.8333333333333334),
    #     (0.4375, 0.8291666666666666),
    #     (0.425, 0.8125),
    #     (0.425, 0.8125),
    #     (0.43333333333333335, 0.8083333333333333),
    #     (0.4583333333333333, 0.8041666666666667),
    #     (0.49166666666666664, 0.7958333333333333),
    #     (0.5416666666666666, 0.8),
    #     (0.6125, 0.7958333333333333),
    #     (0.6125, 0.7958333333333333),
    #     (0.6833333333333333, 0.7958333333333333),
    #     (0.7583333333333333, 0.8),
    #     (0.8541666666666666, 0.8041666666666667),
    #     (0.95, 0.8083333333333333),
    #     (1.05, 0.8166666666666667),
    #     (1.125, 0.8166666666666667),
    #     (1.125, 0.8166666666666667),
    #     (1.2208333333333332, 0.825),
    #     (1.3416666666666666, 0.8333333333333334),
    #     (1.4208333333333334, 0.8333333333333334),
    #     (1.4958333333333333, 0.8416666666666667),
    #     (1.5625, 0.85),
    #     (1.6208333333333333, 0.8541666666666666),
    #     (1.6208333333333333, 0.8541666666666666),
    #     (1.6708333333333334, 0.8541666666666666),
    #     (1.7333333333333334, 0.8666666666666667),
    #     (1.7833333333333332, 0.8791666666666667),
    #     (1.8375, 0.8958333333333334),
    #     (1.9, 0.9249999999999999),
    #     (1.9291666666666667, 0.9249999999999999),
    #     (1.9291666666666667, 0.9249999999999999),
    #     (1.9458333333333333, 0.9249999999999999),
    #     (1.9749999999999999, 0.9291666666666667),
    #     (2.0083333333333333, 0.9125),
    #     (2.033333333333333, 0.9208333333333333),
    # ]

    # exp1_path = [(-1.74, 0.48), (2.06, 0.48), (2.06, 1.8)]

    # exp2_path = [(-1.75, 0.7), (2.3, 0.4), (2.15, -1.57)]

    # exp3_path = [(-2.49, 0.62), (1.5, 0.42), (1.5, -1.2)]

    # exp4_path = [(0.13, 0.5), (-2.62, 0.5), (-2.65, -1.25)]

    # exp5_path = [(1.16, 0.38), (-1.58, 0.4), (-1.6, -1.28)]

    swarmalator = Swarmalator(spheros, 1, 1, phase, natural_frequencies, target=None)

    # Run the experiments
    run_experiments(
        [SPHEROS_NEW],
        [PORT1],
        swarmalator,
        CAMERA_ID,
        targets=SAM_waypoints_smooth[::10],
    )


if __name__ == "__main__":
    main()
